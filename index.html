<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Colorimeter: Betalain (Beetroot)</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="app-header">
    <h1>Colorimeter Simulator ‚Äî Betalain (Beetroot)</h1>
    <div class="header-right">
      <button id="advancedToggle" class="ghost" aria-expanded="false" aria-controls="advancedPanel">Advanced</button>
      <button id="resetAll" class="ghost">Reset</button>
      <a class="ghost" href="#about">About</a>
    </div>
  </header>

  <main class="layout">
    <section class="panel controls">
      <h2>Controls</h2>
      <div class="control">
        <label for="wavelength">Wavelength (nm)
          <output id="wavelengthOut">538</output>
        </label>
        <input type="range" id="wavelength" min="380" max="700" value="538" step="1" />
      </div>

      <div class="control">
        <label for="concentration">Concentration (mM)
          <output id="concentrationOut">0.50</output>
        </label>
        <input type="range" id="concentration" min="0" max="1.5" value="0.5" step="0.01" />
      </div>


      <div class="control">
        <label class="checkbox">
          <input type="checkbox" id="noiseToggle" checked />
          Include instrument noise
        </label>
      </div>

      <div class="buttons">
        <button id="measureBtn">Measure (add to calibration)</button>
        <button id="autoCalibrateBtn" class="ghost" aria-pressed="false" title="Auto-generate calibration points">üìà Auto calibrate</button>
        <button id="unknownBtn" class="ghost" title="Add and read an unknown sample">‚ùì Unknown sample</button>
        <button id="clearCalibration" class="ghost">Clear calibration</button>
      </div>

      <div id="advancedPanel" class="advanced is-hidden">
        <div class="advanced-group">
          <button id="toggleSpectrum" class="adv-sub-toggle ghost" aria-expanded="false" aria-controls="spectrumPanel">Spectrum ‚ñ∏</button>
          <div id="spectrumPanel" class="adv-sub-panel is-hidden">
            <div class="chart">
              <div class="chart-head">
                <h3>Spectrum</h3>
                <span class="sub">Œµ(Œª) and A(Œª) for current settings</span>
              </div>
              <canvas id="spectrumChart" height="160"></canvas>
            </div>
          </div>
          <button id="toggleBleaching" class="adv-sub-toggle ghost" aria-expanded="false" aria-controls="bleachingPanel">Bleaching ‚ñ∏</button>
          <div id="bleachingPanel" class="adv-sub-panel is-hidden">
            <h3>Bleaching simulation</h3>
            <p class="hint">Optional: simulate photodegradation of betalain under light.</p>
            <div class="control">
              <label for="bleachRate">Bleach rate k (1/min)
                <output id="bleachRateOut">0.020</output>
              </label>
              <input type="range" id="bleachRate" min="0" max="0.1" value="0.02" step="0.001" />
            </div>
            <div class="buttons">
              <button id="bleachToggle">Start bleaching</button>
              <button id="bleachReset" class="ghost">Reset concentration</button>
            </div>
            <div class="chart">
              <div class="chart-head">
                <h3>Bleaching over time</h3>
                <span class="sub">Concentration decay under light</span>
              </div>
              <canvas id="timeChart" height="160"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="readouts">
        <div class="readout"><span>Absorbance A:</span><strong id="absorbanceOut">0.000</strong></div>
        <div class="readout"><span>Transmittance T:</span><strong id="transmittanceOut">100.0%</strong></div>
        <div class="readout"><span>Detector signal:</span><strong id="detectorOut">1.000</strong></div>
      </div>
    </section>

    <section class="panel viz">
      <h2>Instrument view</h2>
      <div class="colorimeter" aria-label="Colorimeter visualization">
        <svg id="instrumentSVG" viewBox="0 0 900 240" role="img" aria-labelledby="instrumentTitle instrumentDesc">
          <title id="instrumentTitle">Colorimeter schematic</title>
          <desc id="instrumentDesc">Light passes through a cuvette containing betalain solution and reaches a detector.</desc>
          <!-- Background -->
          <defs>
            <linearGradient id="beamGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#b9f6ca" stop-opacity="0.9" />
              <stop offset="100%" stop-color="#b9f6ca" stop-opacity="0" />
            </linearGradient>
            <linearGradient id="detectorGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#c8e6c9" />
              <stop offset="100%" stop-color="#81c784" />
            </linearGradient>
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>

          <!-- LED source -->
          <g transform="translate(40, 90)">
            <rect x="0" y="0" width="80" height="60" rx="8" fill="#263238" />
            <circle id="led" class="led" cx="80" cy="30" r="10" fill="#16e231" filter="url(#glow)" />
            <text x="40" y="80" text-anchor="middle" class="label">LED</text>
          </g>

          <!-- Beam -->
          <g id="beamGroup">
            <rect id="beam" x="120" y="106" width="520" height="28" fill="url(#beamGrad)" />
            <!-- Moving photon dots -->
            <g id="photons"></g>
          </g>

          <!-- Cuvette with solution -->
          <g transform="translate(360, 40)">
            <rect x="0" y="0" width="100" height="160" rx="6" fill="#90a4ae" opacity="0.3" />
            <rect id="solution" x="8" y="8" width="84" height="144" rx="4" fill="#7e57c2" opacity="0.8" />
            <text x="50" y="178" text-anchor="middle" class="label">Cuvette</text>
          </g>

          <!-- Detector -->
          <g transform="translate(720, 70)">
            <rect x="0" y="0" width="140" height="100" rx="10" fill="#263238" />
            <rect id="detector" x="18" y="18" width="104" height="64" rx="6" fill="url(#detectorGrad)" />
            <text x="70" y="120" text-anchor="middle" class="label">Detector</text>
          </g>
        </svg>
      </div>

      <div class="charts">
        <div class="chart">
          <div class="chart-head">
            <h3>Calibration (Beer‚ÄìLambert)</h3>
            <span class="sub">Absorbance vs concentration at selected Œª</span>
          </div>
          <canvas id="calibrationChart" height="160"></canvas>
          <div class="calib-stats"><span id="calibStats">m = ‚Äî, b = ‚Äî, R¬≤ = ‚Äî</span></div>
          <div id="unknownOverlay" class="unknown-overlay is-hidden" aria-hidden="true">
            <svg viewBox="0 0 100 100" preserveAspectRatio="none">
              <!-- Horizontal arrow from A* to fit line -->
              <defs>
                <marker id="arrowHead" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                  <polygon points="0 0, 6 3, 0 6" fill="#455a64" />
                </marker>
              </defs>
              <line id="arrowH" x1="10" y1="50" x2="60" y2="50" stroke="#455a64" stroke-width="1.5" marker-end="url(#arrowHead)" />
              <!-- Vertical arrow down to x-axis -->
              <line id="arrowV" x1="60" y1="15" x2="60" y2="85" stroke="#455a64" stroke-width="1.5" marker-end="url(#arrowHead)" />
              <!-- Labels -->
              <text id="unknownALabel" x="8" y="48" fill="#455a64" font-size="6">A*</text>
              <text id="unknownCLabel" x="62" y="92" fill="#455a64" font-size="6">ƒâ</text>
            </svg>
          </div>
        </div>
      </div>
    </section>
  </main>

  <section id="about" class="panel about">
    <h2>About betalain and this simulator</h2>
    <p>
      Betalains are vibrant red-purple pigments found in beetroot (beta vulgaris). They absorb strongly
      around the green region of the spectrum (~538 nm), so green light is attenuated while red-blue light is transmitted,
      yielding the characteristic magenta color.
    </p>
    <p>
      This interactive app simulates a single-beam colorimeter using the Beer‚ÄìLambert law A = Œµ(Œª)¬∑c¬∑l. The extinction
      coefficient Œµ(Œª) is modeled with a Gaussian peak near 538 nm for betalain; values are representative, not exact.
      Use it for intuition and teaching‚Äînot quantitative analysis.
    </p>
  </section>

  <footer class="app-footer">
    <span>¬© 2025 ‚Äî Educational simulation. Betalain example inspired by beetroot pigments.</span>
    <div class="spacer"></div>
    <button id="downloadData" class="ghost">Download calibration CSV</button>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
